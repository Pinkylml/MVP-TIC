<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictor de Inserci√≥n Laboral - EPN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --epn-blue: #003DA5;
            --epn-blue-light: #0056D6;
            --epn-blue-dark: #002D7A;
            --fis-accent: #00A8E8;
        }

        .epn-gradient {
            background: linear-gradient(135deg, var(--epn-blue) 0%, var(--epn-blue-light) 100%);
        }

        .sticky-results {
            position: sticky;
            top: 1.5rem;
            max-height: calc(100vh - 3rem);
            overflow-y: auto;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #0f172a;
            color: #fff;
            text-align: left;
            border-radius: 8px;
            padding: 12px;
            position: absolute;
            z-index: 50;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.65rem;
            line-height: 1.4;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .sticky-results::-webkit-scrollbar {
            width: 4px;
        }

        .sticky-results::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen text-slate-900 font-sans">
    <header class="epn-gradient text-white p-5 shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div
                    class="h-10 w-10 bg-white/20 rounded-lg flex items-center justify-center font-black text-xl italic">
                    Œ£</div>
                <div>
                    <h1 class="text-xl font-black tracking-tighter uppercase">Predictor de Inserci√≥n Temprana</h1>
                    <p class="text-[0.6rem] text-blue-100 font-bold tracking-widest uppercase opacity-80">EPN - Facultad
                        de Ingenier√≠a de Sistemas | RSF v2.1</p>
                </div>
            </div>
            <div id="status-indicator"
                class="hidden flex items-center gap-2 bg-emerald-500/20 px-3 py-1.5 rounded-full text-[0.6rem] border border-emerald-500/30">
                <span
                    class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.5)]"></span>
                <span class="font-black uppercase tracking-tighter text-emerald-100">Procesando Perfil...</span>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 lg:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">

            <!-- Left: Settings -->
            <div class="lg:col-span-7 space-y-8">
                <section class="bg-white p-8 rounded-3xl shadow-sm border border-slate-200/60 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-50/50 rounded-bl-full -z-0"></div>

                    <div class="flex items-center justify-between mb-10 relative z-10">
                        <h2 class="text-lg font-black text-slate-800 flex items-center gap-3">
                            <span class="p-2 bg-slate-100 rounded-xl text-base">üîß</span>
                            Configuraci√≥n de Perfil Acad√©mico
                        </h2>
                        <div
                            class="text-[0.6rem] font-bold text-slate-400 border border-slate-100 px-3 py-1 rounded-full bg-slate-50 uppercase tracking-widest">
                            Dataset N=665
                        </div>
                    </div>

                    <!-- Career & Demographics -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12 relative z-10">
                        <div class="space-y-2">
                            <label
                                class="block text-[0.65rem] font-black text-slate-400 uppercase tracking-widest flex items-center gap-2">
                                Carrera de Ingenier√≠a
                                <div class="tooltip text-slate-300">‚ìò <span class="tooltiptext">Mapeo basado en
                                        Resoluciones CD-067-2025.</span></div>
                            </label>
                            <select id="Carrera"
                                class="w-full border-2 border-slate-100 p-3.5 rounded-2xl bg-slate-50/50 focus:border-blue-500 focus:bg-white outline-none transition-all text-sm font-bold text-slate-700">
                                <option value="(RRA20) SOFTWARE">SOFTWARE</option>
                                <option value="(RRA20) COMPUTACI√ìN">COMPUTACI√ìN</option>
                                <option value="(RRA20) DESARROLLO DE SOFTWARE">DESARROLLO DE SOFTWARE</option>
                                <option value="(RRA20) TECNOLOG√çAS DE LA INFORMACI√ìN">TECNOLOG√çAS DE LA INFORMACI√ìN
                                </option>
                                <option value="(RRA20) REDES Y TELECOMUNICACIONES">REDES Y TELECOMUNICACIONES</option>
                                <option value="(RRA20) TELECOMUNICACIONES">TELECOMUNICACIONES</option>
                                <option value="(RRA20) ELECTR√ìNICA Y AUTOMATIZACI√ìN">ELECTR√ìNICA Y AUTOMATIZACI√ìN
                                </option>
                                <option value="(RRA20) ELECTRICIDAD">ELECTRICIDAD</option>
                                <option value="(RRA20) ELECTROMEC√ÅNICA">ELECTROMEC√ÅNICA</option>
                                <option value="(RRA20) MEC√ÅNICA">MEC√ÅNICA</option>
                                <option value="(RRA20) INGENIER√çA CIVIL">INGENIER√çA CIVIL</option>
                                <option value="(RRA20) INGENIER√çA QU√çMICA">INGENIER√çA QU√çMICA</option>
                                <option value="(RRA20) INGENIER√çA AMBIENTAL">INGENIER√çA AMBIENTAL</option>
                                <option value="(RRA20) PETR√ìLEOS">PETR√ìLEOS</option>
                                <option value="(RRA20) GEOLOG√çA">GEOLOG√çA</option>
                                <option value="(RRA20) AGUA Y SANEAMIENTO AMBIENTAL">AGUA Y SANEAMIENTO AMBIENTAL
                                </option>
                                <option value="(RRA20) AGROINDUSTRIA">AGROINDUSTRIA</option>
                                <option value="(RRA20) ADMINISTRACI√ìN DE EMPRESAS">ADMINISTRACI√ìN DE EMPRESAS</option>
                                <option value="(RRA20) INGENIER√çA EMPRESARIAL">INGENIER√çA EMPRESARIAL</option>
                                <option value="(RRA20) INGENIER√çA DE LA PRODUCCI√ìN">INGENIER√çA DE LA PRODUCCI√ìN</option>
                                <option value="(RRA20) ECONOM√çA">ECONOM√çA</option>
                                <option value="(RRA20) INGENIER√çA EN CIENCIAS ECON√ìMICAS Y FINANCIERAS">ING. CIENCIAS
                                    ECON√ìMICAS</option>
                                <option value="(RRA20) F√çSICA">F√çSICA</option>
                                <option value="(RRA20) MATEM√ÅTICA">MATEM√ÅTICA</option>
                                <option value="(RRA20) MATEM√ÅTICA APLICADA">MATEM√ÅTICA APLICADA</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label
                                    class="block text-[0.65rem] font-black text-slate-400 uppercase tracking-widest">Edad
                                    al Grado</label>
                                <div class="relative">
                                    <input type="number" id="Edad" value="23" min="15" max="99"
                                        class="w-full border-2 border-slate-100 p-3.5 rounded-2xl bg-slate-50/50 focus:border-blue-500 focus:bg-white outline-none text-sm font-black text-slate-700">
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="block text-[0.65rem] font-black text-slate-400 uppercase tracking-widest">G√©nero</label>
                                <select id="Genero_bin"
                                    class="w-full border-2 border-slate-100 p-3.5 rounded-2xl bg-slate-50/50 focus:border-blue-500 focus:bg-white outline-none text-sm font-black text-slate-700">
                                    <option value="0">Femenino</option>
                                    <option value="1" selected>Masculino</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Soft Skills Sliders -->
                    <div class="space-y-10 relative z-10">
                        <div class="flex items-center gap-3 border-b-2 border-slate-50 pb-4">
                            <h3 class="text-[0.7rem] font-black text-slate-800 uppercase tracking-[0.2em]">Habilidades
                                Blandas (Autopercepci√≥n)</h3>
                            <div class="tooltip text-blue-400">‚ìò <span class="tooltiptext text-[0.6rem]">Escala de
                                    Likert (1-5) para competencias transversales identificadas en Cando Santos
                                    (2026).</span></div>
                        </div>
                        <div id="inputs" class="grid grid-cols-1 md:grid-cols-2 gap-y-12 gap-x-16">
                            <!-- JS Injection -->
                        </div>
                    </div>

                    <!-- NLP Technical Skills -->
                    <div class="mt-14 rounded-3xl overflow-hidden border border-slate-100 bg-slate-50/30 relative z-10">
                        <details class="group">
                            <summary
                                class="p-6 cursor-pointer flex items-center justify-between font-black text-slate-800 group-open:bg-white transition-all select-none">
                                <div class="flex items-center gap-4">
                                    <span class="text-xl">üíé</span>
                                    <span class="text-xs tracking-widest uppercase opacity-70">Habilidades T√©cnicas
                                        Especializadas</span>
                                </div>
                                <div
                                    class="h-8 w-8 rounded-full border border-slate-200 flex items-center justify-center group-open:rotate-180 transition-transform">
                                    <span class="text-[10px] text-slate-400 group-open:text-blue-500">‚ñº</span>
                                </div>
                            </summary>
                            <div
                                class="p-8 bg-white grid grid-cols-2 md:grid-cols-3 gap-5 animate-in slide-in-from-top-4 duration-300">
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="react, revit"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Frontend /
                                        BIM</span>
                                </label>
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="sql, python"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Analytics/SQL</span>
                                </label>
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="simulaci√≥n"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Simulaci√≥n de
                                        Proc.</span>
                                </label>
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="seguridad"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Seguridad
                                        Inf.</span>
                                </label>
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="finanzas"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Mercados
                                        Financ.</span>
                                </label>
                                <label
                                    class="flex items-center space-x-4 p-4 rounded-2xl border-2 border-slate-50 hover:border-blue-100 hover:bg-blue-50 transition-all cursor-pointer">
                                    <input type="checkbox" id="arquitectura"
                                        class="tech-skill w-6 h-6 rounded-lg text-blue-600 focus:ring-blue-500 border-2 border-slate-200">
                                    <span class="text-[0.6rem] font-black text-slate-600 uppercase">Arq.
                                        Computad.</span>
                                </label>
                            </div>
                        </details>
                    </div>

                    <!-- Predict button -->
                    <div class="mt-12">
                        <button onclick="predict()"
                            class="epn-gradient text-white w-full py-6 rounded-3xl font-black text-sm tracking-[0.3em] shadow-[0_20px_40px_-15px_rgba(0,61,165,0.4)] hover:shadow-[0_25px_50px_-12px_rgba(0,61,165,0.5)] hover:scale-[1.01] active:scale-[0.98] transition-all flex items-center justify-center space-x-4 uppercase group">
                            <span>Calcular Inserci√≥n Laboral</span>
                            <span class="text-lg group-hover:translate-x-2 transition-transform">‚Üí</span>
                        </button>
                    </div>
                </section>
            </div>

            <!-- Right: Results -->
            <div class="lg:col-span-5 sticky-results">
                <section id="results-container"
                    class="glass-card rounded-[2.5rem] shadow-2xl border border-white overflow-hidden flex flex-col min-h-[500px]">
                    <div id="no-results"
                        class="flex-grow flex flex-col items-center justify-center p-12 text-center space-y-6">
                        <div
                            class="w-20 h-20 bg-blue-50 text-blue-600 rounded-[2rem] flex items-center justify-center text-4xl animate-pulse ring-8 ring-blue-50/50">
                            üéØ</div>
                        <div>
                            <h3 class="font-black text-slate-800 text-sm uppercase tracking-[0.2em]">Inferencia
                                Estad√≠stica</h3>
                            <p class="text-[0.7rem] text-slate-400 mt-3 leading-relaxed max-w-[220px]">Los resultados
                                aparecer√°n aqu√≠ tras procesar el perfil del graduado.</p>
                        </div>
                    </div>

                    <div id="results-content" class="hidden animate-in zoom-in-95 fade-in duration-700">
                        <div class="bg-slate-900 text-white p-8">
                            <h2 class="text-2xl font-black tracking-tighter mb-1 uppercase">Resultado de Supervivencia
                            </h2>
                            <p class="text-[0.6rem] font-bold text-blue-400 uppercase tracking-[0.3em]">Horizonte de
                                Inserci√≥n Temprana (6.0m)</p>
                        </div>

                        <div class="p-8 space-y-10">
                            <!-- Main Probability Card -->
                            <div
                                class="bg-blue-600 text-white p-7 rounded-[2rem] shadow-2xl shadow-blue-600/30 relative overflow-hidden group">
                                <div
                                    class="absolute -right-8 -top-8 w-32 h-32 bg-white/10 rounded-full blur-2xl group-hover:scale-150 transition-transform">
                                </div>
                                <div class="flex items-center justify-between mb-4 relative z-10">
                                    <p class="text-[0.6rem] font-black uppercase tracking-[0.2em] opacity-80">
                                        Probabilidad de Inserci√≥n (‚â§ 6m)</p>
                                    <div class="tooltip text-white/50 hover:text-white">‚ìò <span
                                            class="tooltiptext">M√©trica Interpolada: Muestra la probabilidad de √©xito
                                            dentro de la ventana observada. [IBS=0.105]</span></div>
                                </div>
                                <div class="flex items-baseline gap-3 relative z-10">
                                    <span id="prob_display"
                                        class="text-6xl font-black tracking-tighter italic">--</span>
                                    <span class="text-2xl font-bold opacity-70">%</span>
                                </div>
                                <div class="mt-6 h-2 bg-white/20 rounded-full overflow-hidden relative z-10">
                                    <div id="prob_progress"
                                        class="h-full bg-white shadow-[0_0_15px_rgba(255,255,255,0.8)] transition-all duration-[1.5s] ease-out"
                                        style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- Percentiles -->
                            <div class="grid grid-cols-2 gap-5">
                                <div
                                    class="bg-slate-50 p-5 rounded-2xl border border-slate-100 flex flex-col justify-between">
                                    <p class="text-[0.55rem] font-black text-slate-400 uppercase mb-3">Primer Quartil
                                        (p25)</p>
                                    <div class="flex items-baseline gap-1.5">
                                        <span id="p25_display" class="text-2xl font-black text-slate-800">--</span>
                                        <span class="text-[0.6rem] font-bold text-slate-400 uppercase">meses</span>
                                    </div>
                                </div>
                                <div id="p50_container"
                                    class="bg-slate-900 text-white p-5 rounded-2xl flex flex-col justify-between transition-colors">
                                    <p class="text-[0.55rem] font-black opacity-50 uppercase mb-3">Mediana de Tiempo
                                        (p50)</p>
                                    <div class="flex items-baseline gap-1.5">
                                        <span id="p50_display"
                                            class="text-2xl font-black text-blue-400 italic">--</span>
                                        <span id="p50_label"
                                            class="text-[0.6rem] font-bold opacity-50 uppercase">meses</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Curve -->
                            <div class="bg-slate-50 p-6 rounded-[2rem] border border-slate-100">
                                <div class="flex items-center justify-between mb-5">
                                    <h3 class="text-[0.6rem] font-black text-slate-400 uppercase tracking-widest">S(t):
                                        Supervivencia (Desempleo)</h3>
                                </div>
                                <div class="h-[200px]">
                                    <canvas id="survivalChart"></canvas>
                                </div>
                            </div>

                            <!-- Narrative Report -->
                            <div id="report-narrative" class="bg-blue-50/40 p-6 rounded-2xl border-l-4 border-blue-600">
                                <h4
                                    class="text-[0.65rem] font-black text-blue-900 uppercase mb-3 flex items-center gap-2">
                                    <span>üìë</span> An√°lisis Interpretativo
                                </h4>
                                <p id="interpretationText"
                                    class="text-[0.7rem] text-slate-600 leading-[1.6] font-medium"></p>
                            </div>

                            <!-- Scientific Footer inside Results -->
                            <div class="pt-6 border-t border-slate-100">
                                <p class="text-[0.55rem] text-slate-400 italic font-medium leading-relaxed">
                                    * Este resultado se basa en un seguimiento de 6 meses (Cando Santos, 2026). Un p50
                                    indeterminado indica que la inserci√≥n de la mediana del grupo ocurre fuera de la
                                    ventana observada.
                                </p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Academic Citations Footer -->
        <section class="mt-16 bg-white p-8 rounded-3xl border border-slate-100">
            <h4 class="text-[0.65rem] font-black text-slate-400 uppercase tracking-[0.4em] mb-6 text-center">Marco
                Referencial y Metodol√≥gico</h4>
            <div
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 text-[0.65rem] text-slate-500 leading-relaxed font-medium">
                <div class="space-y-2 p-4 bg-slate-50/50 rounded-2xl">
                    <p class="font-black text-slate-700 uppercase tracking-tighter">Cando Santos, J. S. (2026)</p>
                    <p>"Aplicaci√≥n de ciencia de datos para la evaluaci√≥n y fortalecimiento de habilidades blandas en la
                        empleabilidad...". EPN, Quito.</p>
                </div>
                <div class="space-y-2 p-4 bg-slate-50/50 rounded-2xl">
                    <p class="font-black text-slate-700 uppercase tracking-tighter">Ishwaran et al. (2008)</p>
                    <p>"Random survival forests". The Annals of Applied Statistics. Fundamento del algoritmo
                        implementado para capturar no-linealidades.</p>
                </div>
                <div class="space-y-2 p-4 bg-slate-50/50 rounded-2xl">
                    <p class="font-black text-slate-700 uppercase tracking-tighter">Barnwal et al. (2022)</p>
                    <p>"Survival Regression with AFT Model in XGBoost". Justificaci√≥n t√©cnica de las restricciones de
                        frontera temporal y censura.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="mt-12 py-12 bg-slate-900 text-slate-500">
        <div class="max-w-7xl mx-auto px-10 flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="text-center md:text-left">
                <p class="text-[0.7rem] font-black text-white uppercase tracking-[0.5em] mb-2">STEM-TIC Research Project
                </p>
                <p class="text-[0.6rem] opacity-50 uppercase tracking-widest">Desarrollado para la Facultad de
                    Ingenier√≠a de Sistemas - EPN</p>
            </div>
            <div class="flex gap-6 grayscale opacity-50 hover:grayscale-0 transition-all">
                <span class="text-xs font-black italic">FIS-EPN</span>
                <span class="text-xs font-black italic">Python SDK</span>
                <span class="text-xs font-black italic">Scikit-Survival</span>
            </div>
        </div>
    </footer>

    <script>
        const skillsLabels = [
            'S1: Comunicaci√≥n Espa√±ola',
            'S2: Compromiso √âtico',
            'S3: Trabajo en Equipo / Liderazgo',
            'S4: Responsabilidad Social',
            'S5: Gesti√≥n de Proyectos',
            'S6: Aprendizaje Digital',
            'S7: Ingl√©s'
        ];

        const inputDiv = document.getElementById('inputs');
        [1, 2, 3, 4, 5, 6, 7].forEach(num => {
            const div = document.createElement('div');
            div.className = "group relative pb-2";
            div.innerHTML = `
                <div class="flex justify-between items-center mb-5">
                    <label class="text-[0.65rem] font-black text-slate-500 uppercase tracking-widest">${skillsLabels[num - 1]}</label>
                    <span id="valS${num}" class="text-[0.7rem] font-black text-blue-600 bg-blue-50 border border-blue-100 px-3 py-1 rounded-xl shadow-sm">3.0</span>
                </div>
                <input type="range" id="S${num}" value="3.0" min="1.0" max="5.0" step="0.5" 
                       oninput="document.getElementById('valS${num}').textContent = parseFloat(this.value).toFixed(1)"
                       class="w-full h-2 bg-slate-100 rounded-full appearance-none cursor-pointer accent-blue-600 border-none transition-all hover:bg-slate-200">
                <div class="flex justify-between mt-3 px-1">
                    <span class="text-[0.55rem] font-black text-slate-300 uppercase">Debilidad</span>
                    <span class="text-[0.55rem] font-black text-slate-300 uppercase">Excelencia</span>
                </div>
            `;
            inputDiv.appendChild(div);
        });

        async function predict() {
            const status = document.getElementById('status-indicator');
            status.classList.remove('hidden');

            const technicalSkills = {};
            document.querySelectorAll('.tech-skill').forEach(checkbox => {
                technicalSkills[checkbox.id] = checkbox.checked ? 1.0 : 0.0;
            });

            const data = {
                S1: parseFloat(document.getElementById('S1').value),
                S2: parseFloat(document.getElementById('S2').value),
                S3: parseFloat(document.getElementById('S3').value),
                S4: parseFloat(document.getElementById('S4').value),
                S5: parseFloat(document.getElementById('S5').value),
                S6: parseFloat(document.getElementById('S6').value),
                S7: parseFloat(document.getElementById('S7').value),
                Edad: parseInt(document.getElementById('Edad').value),
                Genero_bin: parseInt(document.getElementById('Genero_bin').value),
                Carrera: document.getElementById('Carrera').value,
                technical_skills: technicalSkills
            };

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error(await response.text());
                const result = await response.json();
                displayResults(result);
                if (window.innerWidth < 1024) document.getElementById('results-container').scrollIntoView({ behavior: 'smooth' });
            } catch (err) {
                alert("‚ùå Error en el Motor RSF: " + err.message);
            } finally {
                status.classList.add('hidden');
            }
        }

        function displayResults(result) {
            document.getElementById('no-results').classList.add('hidden');
            document.getElementById('results-content').classList.remove('hidden');

            const prob = result.prob_6m * 100;
            const probDisplay = document.getElementById('prob_display');
            const probProgress = document.getElementById('prob_progress');

            // Animation for prob
            let current = 0;
            const step = prob / 30;
            const interval = setInterval(() => {
                current += step;
                if (current >= prob) {
                    probDisplay.textContent = prob.toFixed(1);
                    clearInterval(interval);
                } else {
                    probDisplay.textContent = current.toFixed(1);
                }
            }, 30);

            probProgress.style.width = prob + '%';

            // Percentiles formatting
            const formatP = (v) => v === -1.0 ? "> 6.0" : v.toFixed(1);
            document.getElementById('p25_display').textContent = formatP(result.percentiles.p25);

            const p50 = result.percentiles.p50;
            const p50Disp = document.getElementById('p50_display');
            const p50Cont = document.getElementById('p50_container');

            p50Disp.textContent = formatP(p50);
            if (p50 === -1.0) {
                p50Cont.classList.remove('bg-slate-900', 'text-blue-400');
                p50Cont.classList.add('bg-amber-50', 'text-amber-800', 'border-amber-200');
                document.getElementById('p50_label').textContent = "";
            } else {
                p50Cont.classList.remove('bg-amber-50', 'text-amber-800', 'border-amber-200');
                p50Cont.classList.add('bg-slate-900', 'text-white');
                document.getElementById('p50_label').textContent = "meses";
            }

            // Academic Interpretation
            let text = `El modelo RSF estima una probabilidad del <strong>${prob.toFixed(1)}%</strong> de inserci√≥n formal antes de completar el primer semestre (Horizonte de Inserci√≥n Temprana). `;

            if (p50 === -1.0) {
                text += `Dado el perfil, el riesgo de desempleo prolongado es superior al 50% al mes 6 ($S(6) > 0.50$). Se recomienda fortalecer las habilidades t√©cnicas SHAP para acelerar la transici√≥n Escuela-Trabajo como se sugiere en Cando Santos (2026).`;
            } else {
                text += `La mediana del tiempo de inserci√≥n se proyecta en los <strong>${p50.toFixed(1)} meses</strong>, situ√°ndose dentro de la ventana de observaci√≥n de la investigaci√≥n.`;
            }

            document.getElementById('interpretationText').innerHTML = text;
            renderChart(result.survival_curve);
        }

        let chart = null;
        function renderChart(curveData) {
            const ctx = document.getElementById('survivalChart').getContext('2d');
            const labels = curveData.map(d => d.t.toFixed(1));
            const values = curveData.map(d => d.S_t);
            if (chart) chart.destroy();
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Funci√≥n de Supervivencia S(t)',
                        data: values,
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 4,
                        pointRadius: 0,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1.0,
                            grid: { color: 'rgba(0,0,0,0.03)' },
                            ticks: { font: { size: 10, weight: '700' }, color: '#94a3b8' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: {
                                maxRotation: 0,
                                font: { size: 10, weight: '700' },
                                color: '#94a3b8',
                                callback: (v, i) => i % 20 === 0 ? labels[i] : ''
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#0f172a',
                            padding: 12,
                            cornerRadius: 12,
                            callbacks: { label: (c) => ` Riesgo de desempleo: ${(c.raw * 100).toFixed(1)}%` }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>